<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>WebSocket Sample</title>
    <script type="text/javascript" src="/jquery-3.0.0.min.js"></script>
    <script type="text/javascript" src="/rtc_ws.js"></script>
    <script type="text/javascript">
        var uri = "ws://" + location.host + "/ws/rpc";
        var rtc = new RtcWs();
        function init() {
            $("[data-name='message']").keypress(press);
            rtc.open();
            rtc.waitOpened(rtc);

            chat('Connect to server');
        }

        function plus(a, b, v) {
           chat("Call %d + %d" % (a, b));
           return a+b;
        }

        function plus1(a) {
           return a+1;
        }

        function press(event) {
            if (event && event.which == 13) {
                var message = $("[data-name='message']").val();
                chat(message);
                console.log(res);
            //    rtc.send("" + message);
                $("[data-name='message']").val("");
            }
        }

        function chat(message) {
            var chats = $("[data-name='chat']").find("div");
            while (chats.length >= 100) {
                chats = chats.last().remove();
            }
            var msgtag = $("<div>").text(message);
            $("[data-name='chat']").prepend(msgtag);
            return message;
        }

        $(init);
    </script>
</head>
<body>
    <input type="text" data-name="message" size="100" />
    <hr />
    <div data-name="chat"></div>
</body>
</html>

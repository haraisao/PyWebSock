<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>RTC-Snap! interface</title>
    <script type="text/javascript" src="/jquery-3.0.0.min.js"></script>
    <script type="text/javascript" src="/snap/rtc_ws.js"></script>

    <script type="text/javascript">
        var rtc = new RtcWs();
        var max_lines = 25;

        function init() {
          $("[data-name='message']").keypress(press);
          rtc.open('rpc');
          rtc.waitOpened(rtc);

          show_msg('Connect to server');
          rtc.getProjectList(updateProjectList, 250);
        }

        /* key input event handler */
        function press(event) {
          if (event && event.which == 13) {
            var message = $("[data-name='message']").val();
            proc_press(message);
            $("[data-name='message']").val("");
          }
        }

        function proc_press(message) {
          show_msg(message);
          eval(message);
          //rtc.send(message);
        }

        /** dispay message **/
        function show_msg(message) {
          var msgs = $("[data-name='disp']").find("div");
          while (msgs.length >= max_lines) {
            msgs = msgs.last().remove();
          }
          var msgtag = $("<div>").text(message);
          $("[data-name='disp']").prepend(msgtag);
          return message;
        }

        /**** Commands ***/
        function updateProjectList(lst) {
          lstview = rtc.mkProjectList(lst);
          $("[data-name='project-list']").html(lstview);
        }

        function exit() {
          rtc.call('exit', null);
        }

        /** call initialize **/
        $(init);
          
    </script>
</head>
<body>
  <div style="width:45%;position:absolute-block;top:0px;left:0%;">
    Command:<input type="text" data-name="message" size="20" />
    <hr />
    <div data-name="disp"></div>

  </div>

  <div style="width:45%;position:absolute;top:0px;left:50%;">
  <h2>List of Projects</h2>
  <button onClick="getProjectList();">Update List</button>
  <button onClick="rtc.check_result();">Check</button>
    <hr />
    <div data-name="project-list"></div>
  </div>

</body>
</html>

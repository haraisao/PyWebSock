<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>RTC-Snap! interface</title>
    <script type="text/javascript" src="/jquery-3.0.0.min.js"></script>
    <script type="text/javascript" src="/snap/rtc_ws.js"></script>

    <script type="text/javascript">
        var uri = "ws://" + location.host + "/ws/rpc";
        var rtc = new RtcWs();
        var list_w = 5;

        function init() {
            $("[data-name='message']").keypress(press);
            rtc.open(uri);
            rtc.waitOpened(rtc);

            chat('Connect to server');
            getProjectList();
        }

        function press(event) {
            if (event && event.which == 13) {
                var message = $("[data-name='message']").val();
                  chat(message);
                  eval(message);
                  //rtc.send(message);
                  $("[data-name='message']").val("");
            }
        }

        function chat(message) {
            var chats = $("[data-name='chat']").find("div");
            while (chats.length >= 25) {
                chats = chats.last().remove();
            }
            var msgtag = $("<div>").text(message);
            $("[data-name='chat']").prepend(msgtag);
            return message;
        }

        function getProjectList() {
          rtc.getProjectList(updateProjectList, 100);
        }

        function updateProjectList(lst) {
            lstview = rtc.mkProjectList(lst);
            $("[data-name='project-list']").html(lstview);
        }

        function exit() {
          rtc.call('exit', null);
        }

        $(init);
          
    </script>
</head>
<body>
  <div style="width:45%;position:absolute-block;top:0px;left:0%;">
    Command:<input type="text" data-name="message" size="20" />
    <hr />
    <div data-name="chat"></div>

  </div>

  <div style="width:45%;position:absolute;top:0px;left:50%;">
  <h2>List of Projects</h2>
  <button onClick="getProjectList();">Update List</button>
  <button onClick="rtc.check_result();">Check</button>
    <hr />
    <div data-name="project-list"></div>
  </div>

</body>
</html>
